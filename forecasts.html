<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WXLaunch | Forecasts</title>

<style>
:root{
  --bg:#0b1020;
  --text:#eaf0ff;
  --muted:#a9b4d6;
  --line:rgba(255,255,255,.10);
  --accent:#6aa7ff;
  --stroke: rgba(255,255,255,.14);
  --stroke2: rgba(255,255,255,.20);
  --glass2: rgba(15,23,48,.45);
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:16px;
  min-height:100vh;
  font-family: Arial, Helvetica, sans-serif;
  background:
    radial-gradient(1200px 600px at 20% 10%, rgba(40,110,160,.35), transparent 60%),
    radial-gradient(900px 500px at 80% 30%, rgba(20,80,140,.25), transparent 55%),
    linear-gradient(135deg, #050714 0%, #0a1026 45%, #0b1f3a 100%);
  color:#fff;
}

.wrap{
  width:100%;
  margin:0;
  max-width:none;
}


/* ================= HEADER ================= */

.header-glass{
  padding:18px 20px;
  border-radius:14px;
  background: linear-gradient(
    180deg,
    rgba(20, 90, 150, 0.45),
    rgba(10, 45, 85, 0.35)
  );
  backdrop-filter: blur(12px);
  border:1px solid rgba(255,255,255,.18);
  box-shadow:
    0 10px 30px rgba(0,0,0,.35),
    inset 0 1px 0 rgba(255,255,255,.15);
  margin-bottom:22px;
}

.topbar{
  display:flex;
  flex-direction:column;
  gap:20px;
}

.logo-wrap img{
  height:70px;
  width:auto;
  display:block;
}

.navContainer{
  display:flex;
  gap:60px;
  flex-wrap:wrap;
}

.navGroup{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.navLabel{
  font-size:11px;
  font-weight:900;
  letter-spacing:2px;
  text-transform:uppercase;
  color:rgba(255,255,255,0.55);
}

.navRow{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.tab{
  border:1px solid rgba(255,255,255,.25);
  background: rgba(13, 91, 120, 0.65);
  color:#fff;
  font-weight:700;
  padding:8px 16px;
  cursor:pointer;
  backdrop-filter:blur(6px);
  text-decoration:none;
}

.tab.active{
  background:#fff;
  color:#0b1f3a;
}

/* ================= CARD ================= */

.card{
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
  border:1px solid var(--line);
  border-radius:18px;
  box-shadow: 0 18px 48px rgba(0,0,0,.35);
  padding:18px;
}

.cardHead{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}

.cardHead h1{
  margin:0;
  font-size:18px;
}

.pill{
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.05);
  padding:6px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:13px;
  color:var(--muted);
}

/* ================= VARIABLES ================= */

.topControls{
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:18px;
}

.pillRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.chip{
  border-radius:999px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.06);
  color: var(--text);
  padding:8px 14px;
  font-weight:900;
  cursor:pointer;
}

.chip[aria-pressed="true"]{
  background: rgba(106,167,255,.25);
  border-color: rgba(106,167,255,.55);
}

/* ================= TIMELINE ================= */

.timelineBar{
  padding:16px;
  border:1px solid rgba(255,255,255,.12);
  border-radius:16px;
  background: var(--glass2);
  backdrop-filter: blur(8px);
  margin-bottom:18px;
}

.sliderRow{
  display:flex;
  align-items:center;
  gap:12px;
}

.sliderWrap{
  flex:1;
}

input[type="range"]{
  width:100%;
  accent-color: var(--accent);
}

/* BIG POP OUT ARROWS */

.arrowNav{
  width:46px;
  height:46px;
  border-radius:14px;
  border:1px solid rgba(106,167,255,.6);
  background: linear-gradient(145deg, rgba(106,167,255,.35), rgba(106,167,255,.15));
  color:#fff;
  font-size:22px;
  font-weight:900;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 18px rgba(106,167,255,.35);
  transition:.15s ease;
}

.arrowNav:hover{
  transform:scale(1.08);
  box-shadow:0 0 28px rgba(106,167,255,.6);
}

/* ================= VIEWER ================= */

#forecastViewer{
  width:100%;
  height:75vh;
  min-height:650px;
  border-radius:16px;
  border:1px solid var(--stroke2);
  background: var(--bg);
  overflow:hidden;
  position:relative;
}

#viewerStage{
  position:absolute;
  inset:0;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
}


#forecastImg{
  max-width:100%;
  max-height:100%;
  width:auto;
  height:auto;
  object-fit:contain;
  transform-origin:0 0;
  will-change:transform;
  user-select:none;
  pointer-events:none;
}



.mapTools{
  position:absolute;
  top:12px;
  left:12px;
  display:flex;
  gap:10px;
  padding:8px 10px;
  border-radius:16px;
  background: rgba(11,16,32,.65);
  border:1px solid rgba(255,255,255,.2);
  z-index:30;   /* üî• THIS IS WHAT YOU'RE MISSING */
}


.toolBtn{
  width:38px;
  height:34px;
  border-radius:12px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.08);
  color:#fff;
  font-weight:900;
  cursor:pointer;
}

.toolReset{
  padding:0 14px;
  width:auto;
}

.viewer-overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  background: rgba(0,0,0,.26);
  opacity:0;
}
.viewer-overlay.show{opacity:1;}
</style>
</head>

<body>

<div class="wrap">

<div class="header-glass">
  <div class="topbar">
    <div class="logo-wrap">
      <img src="wxlaunch-logo.png">
    </div>

    <div class="navContainer">
      <div class="navGroup">
        <div class="navLabel">SNAPSHOTS</div>
        <div class="navRow">
          <a class="tab" href="index.html">Basics</a>
          <a class="tab" href="index.html#severe">Severe Weather</a>
          <a class="tab" href="index.html#tropical">Tropical Weather</a>
          <a class="tab" href="index.html#winter">Winter Weather</a>
        </div>
      </div>

      <div class="navGroup">
        <div class="navLabel">ANALYSIS & GUIDANCE</div>
        <div class="navRow">
          <a class="tab active" href="forecasts.html">Forecasts</a>
          <a class="tab" href="models.html">Models</a>
          <a class="tab" href="soundings.html">Soundings</a>
          <a class="tab" href="satellite.html">Satellite</a>
        </div>
      </div>
    </div>
  </div>
</div>

<section class="card">

  <div class="cardHead">
    <h1 id="forecastTitle">Forecast Viewer</h1>
    <div class="pill" id="generatedAtPill">Updated: ‚Äî</div>
  </div>

  <div class="topControls">
    <strong>Variables</strong>
    <div class="pillRow" id="pillRow"></div>
  </div>

  <div class="timelineBar">
    <div class="sliderRow">
      <button class="arrowNav" id="prevBtn">‚ùÆ</button>
      <div class="sliderWrap">
        <input type="range" id="forecastSlider" min="0" max="0" step="1" value="0">
      </div>
      <button class="arrowNav" id="nextBtn">‚ùØ</button>
      <div class="pill" id="validLocalPill">Valid: ‚Äî</div>
    </div>
  </div>

  <div id="forecastViewer">
    <div class="viewer-overlay" id="viewerOverlay">Loading‚Ä¶</div>

    <div class="mapTools">
      <button class="toolBtn" id="zoomOutBtn">‚àí</button>
      <button class="toolBtn" id="zoomInBtn">+</button>
      <button class="toolBtn toolReset" id="resetViewBtn">Reset</button>
    </div>

    <div id="viewerStage">
      <img id="forecastImg" src="maps/latest_maxt_ndfd.png">
    </div>
  </div>

</section>
</div>

<script>
const VARS=[
{key:"maxt",label:"Max Temp (¬∞F)"},
{key:"mint",label:"Min Temp (¬∞F)"},
{key:"dew",label:"Dewpoint (¬∞F)"},
{key:"qpf",label:"QPF (in)"},
{key:"snow",label:"Snow (in)"},
{key:"wgust",label:"Wind Gust (mph)"}
];

const els={
pillRow:document.getElementById("pillRow"),
title:document.getElementById("forecastTitle"),
updated:document.getElementById("generatedAtPill"),
slider:document.getElementById("forecastSlider"),
valid:document.getElementById("validLocalPill"),
img:document.getElementById("forecastImg"),
stage:document.getElementById("viewerStage"),
zoomIn:document.getElementById("zoomInBtn"),
zoomOut:document.getElementById("zoomOutBtn"),
reset:document.getElementById("resetViewBtn"),
prev:document.getElementById("prevBtn"),
next:document.getElementById("nextBtn")
};

let selectedVar="maxt";
let manifest=null;

const viewer={scale:1,x:0,y:0,drag:false,sx:0,sy:0};

function clamp(n,min,max){return Math.max(min,Math.min(max,n));}
function apply(){els.img.style.transform=`translate(${viewer.x}px,${viewer.y}px) scale(${viewer.scale})`;}
function resetView(){viewer.scale=1;viewer.x=0;viewer.y=0;apply();}

els.stage.onwheel=e=>{
e.preventDefault();
viewer.scale=clamp(viewer.scale+(e.deltaY<0?0.2:-0.2),1,5);
apply();
};

els.stage.onmousedown=e=>{
viewer.drag=true;
viewer.sx=e.clientX-viewer.x;
viewer.sy=e.clientY-viewer.y;
};
window.onmouseup=()=>viewer.drag=false;
window.onmousemove=e=>{
if(!viewer.drag)return;
viewer.x=e.clientX-viewer.sx;
viewer.y=e.clientY-viewer.sy;
apply();
};

els.zoomIn.onclick=()=>{viewer.scale=clamp(viewer.scale+0.3,1,5);apply();};
els.zoomOut.onclick=()=>{viewer.scale=clamp(viewer.scale-0.3,1,5);apply();};
els.reset.onclick=resetView;

function renderPills(){
els.pillRow.innerHTML="";
VARS.forEach(v=>{
const b=document.createElement("button");
b.className="chip";
b.textContent=v.label;
b.setAttribute("aria-pressed",v.key===selectedVar);
b.onclick=()=>{
selectedVar=v.key;
renderPills();
loadVar(v.key);
};
els.pillRow.appendChild(b);
});
}

async function loadVar(k){
try{
const r=await fetch(`maps/manifest_${k}.json?${Date.now()}`);
manifest=await r.json();
els.title.textContent=manifest.title||"Forecast Viewer";
els.updated.textContent="Updated: "+(manifest.generated_at_utc||"‚Äî");
els.slider.max=manifest.frames.length-1;
showFrame(0);
}catch{
els.img.src=`maps/latest_${k}_ndfd.png?${Date.now()}`;
}
}

function showFrame(i){
if(!manifest?.frames?.length)return;
const f=manifest.frames[i];
els.slider.value=i;
els.valid.textContent="Valid: "+(f.valid_local||"‚Äî");
els.img.src=(f.file.startsWith("maps/")?f.file:"maps/"+f.file)+"?"+Date.now();
}

els.slider.oninput=e=>showFrame(e.target.value);
els.prev.onclick=()=>{if(els.slider.value>0)showFrame(+els.slider.value-1);};
els.next.onclick=()=>{if(manifest && els.slider.value<manifest.frames.length-1)showFrame(+els.slider.value+1);};

renderPills();
loadVar(selectedVar);
apply();
</script>

</body>
</html>
